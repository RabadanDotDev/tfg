\subsection{ToN-IoT}

\subsubsection{Descripción}

ToN es un dataset creado por la University of New South Wales Canberra, Australia \cite{9189760}. Para generarlo, se estructuró un entorno de red con tres capas llamadas Edge, Fog y Cloud para simular un entorno realista. Como tecnología de virtualización, se utiliza NSX-VMware, el cual permite definir una red a través de software (SDN), y para gestionar las máquinas virtuales se ha hecho uso de VMware vSphere hypervisor NFV.

Para la capa Edge, tenemos diferentes dispositivos físicos, un servidor NSX VMWare y diferentes equipos de red. En esta capa, se incluyen diversos sensores IoT tanto simulados como reales y comunicados a través de MQTT. Adicionalmente, se incluyen hosts de usuarios como teléfonos móviles y un televisor. En esta capa, los dispositivos se les asigna una dirección IP en el rango 192.168.1.0/24 a través de DHCP.

En la capa Fog tenemos diferentes máquinas virtualizadas, incluyendo dispositivos vulnerables, atacantes y middleware. Estos son:
\begin{enumerate}
  \item Diez máquinas atacantes con Kali Linux (192.168.1.30-39) con diferentes scripts de ataque.
  \item Máquina virtual ofreciendo DVWA, una aplicación web vulnerable (192.168.1.192)
  \item Máquina virtual con Metasploitable3, una distribución Linux específicamente diseñada para ser vulnerable contra la cual hacer pruebas. (192.168.1.194)
  \item Máquina virtual con OWASP Security Shepherd, una plataforma conteniendo aplicaciones vulnerables sobre las cuales hacer pruebas (192.168.1.184)
  \item Servidor Ubuntu ofreciendo diferentes servicios con FTP, HTTPS, etc. (192.168.1.190)
  \item Un servidor para registrar registros de red de todos los servicios activos (192.168.1.180)
  \item Máquina virtual con Windows 7 (192.168.1.193)
  \item Máquina virtual con Windows 10 (192.168.1.195)
\end{enumerate}

La capa Cloud contiene varios servicios como un broker MQTT, una web vulnerable en PHP, entre servicios cloud para gestionar los mensajes. Esta capa recibe los datos de los dispositivos IoT para ser procesados.

Los dispositivos IoT utilizados consisten en una nevera inteligente, una puerta de garaje remotamente controlada, un objeto con GPS, luces activadas por movimiento, un servicio Modbus con el que se comunican diferentes valores de registros, un termostato inteligente y un sistema de monitorización del clima

Aparte del tráfico benigno, hay 8 ataques, los cuales se han realizado en el momento de generar datos. Estos consisten en:
\begin{enumerate}
  \item \textbf{Escaneo}: ataque basado en el escaneo de puertos para descubrir vectores de ataque potenciales. Se han utilizado nmap y nesus para escanear los puertos disponibles en los dispositivos IoT víctima en el rango 192.\-168.\-1.\-0/24 y en el broker MQTT. Las IP de los atacantes consisten en 192.\-168.\-1.\-30, 192.\-168.\-1.\-31, 192.\-168.\-1.\-32, 192.168.1.\-33 y 192.168.1.\-38
  \item \textbf{Denegación de servicio}: ataque basado en saturar los recursos de un dispositivo para denegar el servicio legítimo. A través de scripts de Python y UFONet se ha tratado de generar ataques de denegación de servicio (dsitribuidos y no distribuidos). Las IP de los atacantes en los ataques no distribuidos son 192.\-168.\-1.\-30, 192.\-168.\-1.\-31 y 192.\-168.1.\-39. Los distribuidos se han realizado desde 192.\-168.\-1.\-30, 192.\-168.\-1.\-31 y 192.\-168.\-1.\-(34-38)
  \item \textbf{Ransomware}: ataque basado en encriptar el sistema de ficheros y vender las claves de descifrado por un precio, "secuestrando" el sistema. El ataque se ha realizado a través del sistema con Metasploitable3 y las IP de los atacantes son 192.168.1.33 y 192.168.1.37.
  \item \textbf{Puertas traseras}: ataque basado en generar en un sistema la capacidad de obtener acceso remoto no autorizado. Se ha utilizado Metasplotaible3 y los ataques se han generado desde 192.168.33 y 192.168.1.37
  \item \textbf{Inyección}: ataque basado en inyectar datos maliciosos para manipular comandos de control e interrumpir el funcionamiento normal del sistema. Se han utilizado scripts en Bash para realizar la inyección y han participado los sistemas 192.168.1(30, 31, 33, 35, 36, 38).
  \item \textbf{Cross-Site Scripting}: ataque basado en provocar la ejecución de código arbitrario en el navegador desde en una página web en otra. Se han utilizado scripts en Bash y la herramienta XSSer para generarlo desde 192.168.1.(32, 35, 36, 39).
  \item \textbf{Descifrado de contraseñas}: ataque basado en fuerza bruta y/o diccionarios para descubrir las claves de acceso a dispositivos. Se han utilizado dos scripts con las herramientas CeWL y Hydra para los ataques de diccionario y fuerza bruta, respectivamente. Los dispositivos atacantes consisten en 192.168.1.(30, 31, 33, 35, 38).
  \item \textbf{Man-In-The-Middle}: ataque basado en tratar de interponerse en medio de las comunicaciones entre dos dispositivos para interceptar información y potencialmente modificar los datos. Los ataques generados se han basado en el envenenamiento del cache ARP, redirección ICMP y robo de puertos. Las máquinas utilizadas han sido 192.168.1.(31, 32, 33, 34).
\end{enumerate}

\subsubsection{Contenidos CSVs}

En el dataset se ofrecen los datos en una variedad de formatos. Los datos procesados incluyen el historial de valores emitidos por los dispositivos IoT, las estadísticas del estado de los sistemas operativos y las características de los flujos. Todas las filas se encuentran etiquetadas, indicando si se trata de datos bajo condiciones normales o bajo un ataque. También se ofrecen los datos en crudo, teniendo los logs de Zeek en formato .log y en formato .csv. Finalmente, hay un grupo de registros "SecurityEvents" o "Ground Truth" indicando el momento y los dispositivos atacados en cada momento con su etiqueta respectiva. Los scripts utilizados para la extracción y representación de los datos son extract\_info\_toniot\_csvs.py y plot\_info\_ton\_csvs.py disponibles en TODO DEFINIR. Para realizar el análisis de los flujos de red, nos hemos basado en los resultados procesados.

No hay ningún tipo de solapamiento en las tipologías de cada ataque tanto en los archivos 'Ground Truth' como en el conjunto procesado. En la figura \ref{fig:toniot_results} podemos ver cómo los principales flujos son escaneos y ataques de denegación de servicio, viniendo después ataques que tratan de realizar descifrado de contraseñas y cross-site scripting. El tráfico normal no se encuentra tan infrarepresentado como en otros casos, pero sigue siendo una porción menor del tráfico. Podemos ver también que los flujos respectivos a ataques MiTM son poco frecuentes en el dataset comparado al resto.

\begin{figure}[H]
  \begin{center}
      \includegraphics[width=0.49\linewidth]{media/toniot_csv_results.png}
  \end{center}
  \captionsetup{justification=centering}
  \caption{Distribución de ataques en TON-IoT}\label{fig:toniot_results}
\end{figure}

Si observamos la línea temporal de la figura \ref{fig:toniot_timeline} podemos ver ciertas tipologías de ataques distribuidos en el tiempo de maneras distintas. De todas maneras, a diferencia del caso de BoT-IoT los tamaños son comparables y se pueden mostrar en una misma escala. Los ataques de escaneo y puerta trasera son los que tienen mayor duración, a continuación tenemos los ataques de denegación de servicio distribuido, no distribuido e intentos de forzar las contraseñas. Finalmente, tenemos ataques de xss, inyección de datos y ransomware. Las cantidades de tráfico visto y sus extensiones temporales son relativamente consistentes con la tipología de ataque. Los ataques de mayor duración (escaneo y descubrimiento de contraseñas) se extienden durante el tiempo para tratar de pasar desapercibidos, los de denegación tratan de colapsar un servicio enviando mucho tráfico en poco tiempo y finalmente los ataques directos tienen una duración más restringida y son más directos. La excepción a esto último son los ataques de puerta trasera, que parecen extenderse en mayor medida a lo que cabria esperar. Es posible que esto sea debido a que la manera de realizar el ataque haya sido menos dirigida, tratando de encontrar una vulnerabilidad, probando diferentes opciones.

\begin{figure}[!htb]
  \begin{center}
      \includegraphics[width=1\linewidth]{media/toniot_csv_timeline.png}
  \end{center}
  \captionsetup{justification=centering}
  \caption{Línea temporal de las trazas con los tipos de ataque en Ton-Iot)}\label{fig:toniot_timeline}
\end{figure}

En total, hay 46 características disponibles en el dataset y explicadas en el conjunto de datos descargables. Manteniendo el formato, las características consisten en:

\begin{enumerate}
  \item \textbf{ts}: Tiempo de inicio del flujo expresado en tiempo Unix con segundos.
  \item \textbf{src\_ip}: Dirección IP de origen.
  \item \textbf{src\_port}: Puerto IP de origen.
  \item \textbf{dst\_ip}: Dirección IP de destino.
  \item \textbf{dst\_proto}: Puerto IP de destino.
  \item \textbf{proto}: Nombre del protocolo transporte utilizado.
  \item \textbf{service}: Protocolos de aplicación detectados, como DNS, HTTP y SSL.
  \item \textbf{duration}: Duración del flujo, calculado a partir de substraer el tiempo del último paquete detectado del primero.
  \item \textbf{src\_bytes}: Bytes enviados por el emisor inicial como datos sobre TCP, si aplica.
  \item \textbf{dst\_bytes}: Bytes enviados por el receptor como inicial como datos sobre TCP, si aplica.
  \item \textbf{conn\_state}: Estado de la conexión, expresado como S0 (intento de conexión sin respuesta), S1 (conexión establecida) y REJ (conexión rechazada).
  \item \textbf{missed\_byttes}: Bytes perdidos detectados en la conexión TCP.
  \item \textbf{src\_pkts}: Número de paquetes enviados por el emisor inicial.
  \item \textbf{src\_ip\_bytes}: Número de bytes enviados sobre IP por el emisor inicial.
  \item \textbf{dst\_pkts}: Número de paquetes enviados por el receptor inicial.
  \item \textbf{dst\_ip\_bytes}: Número de bytes enviados sobre IP por el receptor inicial.
  \item \textbf{dns\_query}: Nombres pedidos en la petición DNS, si aplica.
  \item \textbf{dns\_qclass}: Entero indicando las clases de la petición DNS realizada, si aplica.
  \item \textbf{dns\_qtype}: Entero indicando los tipos de petición DNS realizada, si aplica.
  \item \textbf{dns\_rcode}: Entero indicando el código de respuesta del DNS, si aplica.
  \item \textbf{dns\_AA}: Indicador booleano si la respuesta del DNS es autoritativa, si aplica.
  \item \textbf{dns\_RD}: Indicador booleano si la petición DNS pide recursividad, si aplica.
  \item \textbf{dns\_RA}: Indicador booleano si el servidor DNS soporta recursividad, si aplica.
  \item \textbf{dns\_rejected}: Indicador booleano si el servidor DNS ha rechazado la petición, si aplica.
  \item \textbf{ssl\_version}: La versión SSL ofrecida por el servidor, si aplica
  \item \textbf{ssl\_cipher}: El conjunto de cifrados SSL escogido por el servidor, si aplica.
  \item \textbf{ssl\_resumed}: Indicador booleano indicando que la sesión SSL puede ser utilizada para generar conexiones, si aplica.
  \item \textbf{ssl\_established}: Indicador booleano indicando si existe una sesión SSL establecida, si aplica.
  \item \textbf{ssl\_subject}: Nombre del propietario del certificado SSL, si aplica.
  \item \textbf{ssl\_issuer}: Emisor del certificado SSL y autoridad, si aplica.
  \item \textbf{http\_trans\_depth}: Profundidad de la transferencia HTPP, si aplica.
  \item \textbf{http\_method}: Método HTTP utilizado, si aplica.
  \item \textbf{http\_uri}: URI utilizadas en la petición HTTP, si aplica.
  \item \textbf{http\_version}: Versión HTTP utilizada, si aplica.
  \item \textbf{http\_request\_body\_len}: Longitud de la petición HTTP, si aplica.
  \item \textbf{http\_response\_body\_len}: Longitud de la respuesta HTTP, si aplica.
  \item \textbf{http\_status\_code}: Codigo de respuesta de la petición HTTP, si aplica.
  \item \textbf{http\_user\_agent}: Valores del agente de usuario en la petición HTTP, si aplica.
  \item \textbf{http\_orig\_mime\_types}: Tipos de recursos pedidos en la petición HTTP, si aplica.
  \item \textbf{http\_resp\_mime\_types}: Tipos de recursos devueltos en la petición HTTP, si aplica.
  \item \textbf{weird\_name}: Nombres de las anomalías relacionadas con los protocolos ocurridos.
  \item \textbf{weird\_addl}: Información adicional asociada a las anomalías.
  \item \textbf{weird\_notice}: Indica si la anomalía se ha convertido en una notificación.
  \item \textbf{label}: Indicador si el flujo es normal (0) o un ataque (1)
  \item \textbf{type}: Nombre del tipo de flujo, siendo este normal o DoS, DDoS, etc.
\end{enumerate}

\subsubsection{Contenidos PCAPs}


\input{theoretical_framework/datasets_toniot_protosip.tex}

\input{theoretical_framework/datasets_toniot_protos.tex}

% archivos pcap cortados 
%"/Datasets/TON-IoT/Raw_datasets/network_data/Network_dataset_pcaps/normal_attack_pcaps/Injection_normal/injection_normal1.pcap"
%"/Datasets/TON-IoT/Raw_datasets/network_data/Network_dataset_pcaps/normal_attack_pcaps/Injection_normal/injection_normal4.pcap" 
%"/Datasets/TON-IoT/Raw_datasets/network_data/Network_dataset_pcaps/normal_attack_pcaps/MITM_normal/MITM_normal2.pcap"
%"/Datasets/TON-IoT/Raw_datasets/network_data/Network_dataset_pcaps/normal_attack_pcaps/MITM_normal/MITM_normal3.pcap"
%"/Datasets/TON-IoT/Raw_datasets/network_data/Network_dataset_pcaps/normal_attack_pcaps/normal_DDoS/normal_DDoS_2.pcap"
%"/Datasets/TON-IoT/Raw_datasets/network_data/Network_dataset_pcaps/normal_attack_pcaps/normal_DoS/normal_DoS_1.pcap" 
%"/Datasets/TON-IoT/Raw_datasets/network_data/Network_dataset_pcaps/normal_attack_pcaps/password_normal/password_normal1.pcap"
%"/Datasets/TON-IoT/Raw_datasets/network_data/Network_dataset_pcaps/normal_pcaps/normal_IoT_2.pcap" 
%"/Datasets/TON-IoT/Raw_datasets/network_data/Network_dataset_pcaps/normal_pcaps/normal_IoT_3.pcap" 